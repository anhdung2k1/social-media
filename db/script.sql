--CREATE SEQUENCE
CREATE SEQUENCE USER_SEQ
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 100
    CYCLE;
--DROP SEQUENCE USER_SEQ;
CREATE SEQUENCE ACCOUNT_SEQ
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 100000
    CYCLE;
--DROP SEQUENCE ACCOUNT_SEQ;
CREATE SEQUENCE ROLE_SEQ
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 100000
    CYCLE;
CREATE SEQUENCE COMMENTS_SEQ
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 100000
    CYCLE;
CREATE SEQUENCE NOTIFICATIONS_SEQ
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 100000
    CYCLE;
CREATE SEQUENCE PHOTOINPOSTS_SEQ
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 100000
    CYCLE;  
CREATE SEQUENCE POSTS_SEQ
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 100000
    CYCLE;
CREATE SEQUENCE PHOTOINPOSTS_SEQ
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 100000
    CYCLE;
CREATE SEQUENCE NOTIFICATIONS_SEQ
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 100000
    CYCLE;
CREATE SEQUENCE REACTIONS_SEQ
    START WITH 0
    INCREMENT BY 1
    MINVALUE 0
    MAXVALUE 100000
    CYCLE;

--DROP SEQUENCE ROLE_SEQ;

--CREATE TABLE--
CREATE TABLE USERS(
    USER_ID NUMBER(11) DEFAULT USER_SEQ.nextval,
    USER_NAME VARCHAR2(255),
    BIRTHDAY DATE,
    ADDRESS VARCHAR2(255),
    RELATIONSHIP VARCHAR2(255),
    GENDER VARCHAR2(255),
    FOLLOWER NUMBER(11),
    COVER_URL CLOB,
    AVATAR_URL CLOB,
    CREATE_AT DATE,
    UPDATE_AT DATE,
    CHAT_ID NUMBER(11)
);
ALTER TABLE USERS MODIFY AVATAR_URL LONG;
ALTER TABLE USERS MODIFY COVER_URL LONG;
ALTER TABLE USERS MODIFY AVATAR_URL CLOB;
ALTER TABLE USERS MODIFY COVER_URL CLOB;

CREATE TABLE ACCOUNTS(
    ACC_ID NUMBER(11) DEFAULT ACCOUNT_SEQ.nextval,
    USER_NAME VARCHAR2(20),
    HASH_PASS VARCHAR2(255),
    PHONE_NUM NUMBER(11),
    EMAIL VARCHAR2(255),
    USER_ID NUMBER(11),
    ROLE_ID NUMBER(11),
    IS_ARCHIEVED NUMBER(1),
    CREATE_AT DATE,
    UPDATE_AT DATE
);

CREATE TABLE ACC_ROLES(
    ROLE_ID NUMBER(11) DEFAULT ROLE_SEQ.nextval,
    ROLE_NAME VARCHAR2(255),
    CREATE_AT DATE,
    UPDATE_AT DATE
);

CREATE TABLE COMMENTS(
    CMT_ID NUMBER(11) DEFAULT COMMENTS_SEQ.nextval,
    CMT_CONTENT VARCHAR2(255),
    USERS_ID NUMBER(11),
    REPLY_TO NUMBER(11),
    POST_ID NUMBER(11),
    CREATE_AT DATE,
    UPDATE_AT DATE,
    IS_ARCHIEVED NUMBER(11)
);

CREATE TABLE POSTS(
    POST_ID NUMBER(11) DEFAULT POSTS_SEQ.nextval,
    POST_CONTENT VARCHAR2(255),
    PERMISSION NUMBER(11),
    USER_ID NUMBER(11),
    PHOTOINPOSTS_ID NUMBER(11),
    CREATE_AT DATE,
    UPDATE_AT DATE,
    IS_ARCHIEVED NUMBER(11)
);

CREATE TABLE PHOTOINPOSTS(
    PHOTO_ID NUMBER(11) DEFAULT PHOTOINPOSTS_SEQ.nextval,
    IS_HIGHLIGHT NUMBER(1),
    PHOTO_URL VARCHAR2(255),
    CREATE_AT DATE,
    UPDATE_AT DATE
);

CREATE TABLE NOTIFICATIONS(
    NOTI_ID NUMBER(11) DEFAULT NOTIFICATIONS_SEQ.nextval,
    IS_SEEN NUMBER(1),
    IS_POPULAR NUMBER(1),
    CREATE_AT DATE,
    UPDATE_AT DATE,
    NOTI_TYPE NUMBER(11),
    USER_ID NUMBER(11),
    POST_ID NUMBER(11)
);

CREATE TABLE REACTIONS(
    REACT_ID NUMBER(11) DEFAULT REACTIONS_SEQ.nextval,
    REACT_TAG_ID NUMBER(11),
    CREATE_AT DATE,
    UPDATE_AT DATE,
    POST_ID NUMBER(11),
    USER_ID NUMBER(11),
    CMT_ID NUMBER(11)
);



--CREATE PRIMARY KEY--
ALTER TABLE USERS ADD
    CONSTRAINT USER_PK PRIMARY KEY (USER_ID);
ALTER TABLE ACCOUNTS ADD
    CONSTRAINT ACCID_PK PRIMARY KEY (ACC_ID);
ALTER TABLE ACC_ROLES ADD
    CONSTRAINT ROLEID_PK PRIMARY KEY (ROLE_ID);
ALTER TABLE NOTIFICATIONS ADD
    CONSTRAINT NOTIID_PK PRIMARY KEY (NOTI_ID);
ALTER TABLE PHOTOINPOSTS ADD
    CONSTRAINT PHOTOID_PK PRIMARY KEY (PHOTO_ID);
ALTER TABLE POSTS ADD
    CONSTRAINT POSTID_PK PRIMARY KEY (POST_ID);
ALTER TABLE REACTIONS ADD
    CONSTRAINT REACTIONID_PK PRIMARY KEY (REACT_ID);
    
--CREATE FOREIGN KEY--
--TABLE: ACCOUNTS--
ALTER TABLE ACCOUNTS ADD
    CONSTRAINT ACC_USERID_FK FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID);
ALTER TABLE ACCOUNTS ADD
    CONSTRAINT ACC_ROLEID_FK FOREIGN KEY (ROLE_ID) REFERENCES ACC_ROLES(ROLE_ID);
--TABLE: COMMENTS--
ALTER TABLE COMMENTS ADD
    CONSTRAINT CMT_USERID_FK FOREIGN KEY (USERS_ID) REFERENCES USERS(USER_ID);
ALTER TABLE COMMENTS ADD
    CONSTRAINT CMT_POSTID_FK FOREIGN KEY (POST_ID) REFERENCES POSTS(POST_ID);
--TABLE: REACTIONS--
ALTER TABLE REACTIONS ADD
    CONSTRAINT REACT_POSTID_FK FOREIGN KEY (POST_ID) REFERENCES POSTS(POST_ID);
ALTER TABLE REACTIONS ADD
    CONSTRAINT REACT_CMTID_FK FOREIGN KEY (CMT_ID) REFERENCES COMMENTS(CMT_ID);
--TABLE: NOTIFICATIONS--
ALTER TABLE NOTIFICATIONS ADD
    CONSTRAINT NOTI_USERID_FK FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID);
ALTER TABLE NOTIFICATIONS ADD
    CONSTRAINT NOTI_POSTID_FK FOREIGN KEY (POST_ID) REFERENCES POSTS(POST_ID);
--TABLE: POSTS
ALTER TABLE POSTS ADD
CONSTRAINT POST_PHOTO_FK FOREIGN KEY (PHOTOINPOSTS_ID) REFERENCES PHOTOINPOSTS(PHOTO_ID);
--INSERT DATA--
--TABLE: USERS--
INSERT INTO USERS(USER_NAME, BIRTHDAY,RELATIONSHIP,GENDER, FOLLOWER, CREATE_AT,UPDATE_AT)
VALUES(
	'An',
	TO_DATE('2001-04-22', 'yyyy-mm-dd'),
    'FRIEND',
    'MALE',
	11, 
	TO_DATE(sysdate,'yyyy-mm-dd'),
	TO_DATE(sysdate,'yyyy-mm-dd')
);
INSERT INTO USERS(USER_NAME, BIRTHDAY,RELATIONSHIP,GENDER, FOLLOWER, CREATE_AT,UPDATE_AT)
VALUES(
	'Phuc',
	TO_DATE('2001-04-22', 'yyyy-mm-dd'),
    'FRIEND',
    'MALE',
	11, 
	TO_DATE(sysdate,'yyyy-mm-dd'),
	TO_DATE(sysdate,'yyyy-mm-dd')
);
INSERT INTO USERS(USER_NAME, BIRTHDAY,RELATIONSHIP,GENDER, FOLLOWER, CREATE_AT,UPDATE_AT)
VALUES(
	'Dung',
	TO_DATE('2001-09-11', 'yyyy-mm-dd'),
    'FRIEND',
    'MALE',
	11, 
	TO_DATE(sysdate,'yyyy-mm-dd'),
	TO_DATE(sysdate,'yyyy-mm-dd')
);
INSERT INTO USERS(USER_NAME, BIRTHDAY,RELATIONSHIP,GENDER, FOLLOWER, CREATE_AT,UPDATE_AT)
VALUES(
	'Dat',
	TO_DATE('2001-04-22', 'yyyy-mm-dd'),
    'FRIEND',
    'MALE',
	11, 
	TO_DATE(sysdate,'yyyy-mm-dd'),
	TO_DATE(sysdate,'yyyy-mm-dd')
);
INSERT INTO USERS(USER_NAME, BIRTHDAY,RELATIONSHIP,GENDER, FOLLOWER, CREATE_AT,UPDATE_AT)
VALUES(
	'Hung',
	TO_DATE('2001-04-22', 'yyyy-mm-dd'),
    'FRIEND',
    'MALE',
	11, 
	TO_DATE(sysdate,'yyyy-mm-dd'),
	TO_DATE(sysdate,'yyyy-mm-dd')
);

--TABLE: ACC_ROLES--
INSERT INTO ACC_ROLES(ROLE_NAME, CREATE_AT,UPDATE_AT)
VALUES('ADMIN',TO_DATE(sysdate, 'yyyy-mm-dd'),TO_DATE(sysdate, 'yyyy-mm-dd'));
INSERT INTO ACC_ROLES(ROLE_NAME, CREATE_AT,UPDATE_AT)
VALUES('USER',TO_DATE(sysdate, 'yyyy-mm-dd'),TO_DATE(sysdate, 'yyyy-mm-dd'));
INSERT INTO ACC_ROLES(ROLE_NAME, CREATE_AT,UPDATE_AT)
VALUES('AUDIT',TO_DATE(sysdate, 'yyyy-mm-dd'),TO_DATE(sysdate, 'yyyy-mm-dd'));
INSERT INTO ACC_ROLES(ROLE_NAME, CREATE_AT,UPDATE_AT)
VALUES('MANAGER',TO_DATE(sysdate, 'yyyy-mm-dd'),TO_DATE(sysdate, 'yyyy-mm-dd'));
INSERT INTO ACC_ROLES(ROLE_NAME, CREATE_AT,UPDATE_AT)
VALUES('ACCOUNT',TO_DATE(sysdate, 'yyyy-mm-dd'),TO_DATE(sysdate, 'yyyy-mm-dd'));

--TABLE: ACCOUNT--
INSERT INTO ACCOUNTS(USER_NAME,HASH_PASS, PHONE_NUM, EMAIL, USER_ID, ROLE_ID,IS_ARCHIEVED, CREATE_AT,UPDATE_AT)
VALUES(
	'The AN',
    'ANTESTING123',
	2154554881,
	'an7a3@gmail.com',
	1,
	2,
    1,
	TO_DATE(sysdate, 'yyyy-mm-dd'),
    TO_DATE(sysdate, 'yyyy-mm-dd')
);
INSERT INTO ACCOUNTS(USER_NAME,HASH_PASS, PHONE_NUM, EMAIL, USER_ID, ROLE_ID,IS_ARCHIEVED, CREATE_AT,UPDATE_AT)
VALUES(
	'Hoang Phuc',
    'PHUCTESTING123',
	2154554881,
	'phuc7a3@gmail.com',
	2,
	2,
    1,
	TO_DATE(sysdate, 'yyyy-mm-dd'),
    TO_DATE(sysdate, 'yyyy-mm-dd')
);
INSERT INTO ACCOUNTS(USER_NAME,HASH_PASS, PHONE_NUM, EMAIL,IS_ARCHIEVED, USER_ID, ROLE_ID, CREATE_AT,UPDATE_AT)
VALUES(
	'Anh Dung',
    'DUNGTESTING123',
	335240370,
	'kudung053@gmail.com',
    1,
	3,
	1,
	TO_DATE(sysdate, 'yyyy-mm-dd'),
    TO_DATE(sysdate, 'yyyy-mm-dd')
);
INSERT INTO ACCOUNTS(USER_NAME,HASH_PASS, PHONE_NUM, EMAIL,IS_ARCHIEVED, USER_ID, ROLE_ID, CREATE_AT,UPDATE_AT)
VALUES(
	'Anh Dat',
    'DATTESTING123',
	888333774,
	'dat7a3@gmail.com',
    1,
	4,
	3,
	TO_DATE(sysdate, 'yyyy-mm-dd'),
    TO_DATE(sysdate, 'yyyy-mm-dd')
);
INSERT INTO ACCOUNTS(USER_NAME,HASH_PASS, PHONE_NUM, EMAIL,IS_ARCHIEVED, USER_ID, ROLE_ID, CREATE_AT,UPDATE_AT)
VALUES(
	'Ba Hung',
    'HUNGTESTING123',
	914055773,
	'hung7a3@gmail.com',
    1,
	5,
	4,
	TO_DATE(sysdate, 'yyyy-mm-dd'),
    TO_DATE(sysdate, 'yyyy-mm-dd')
);

--TABLE: POSTS--
INSERT INTO POSTS(POST_ID, USER_ID, CREATE_AT)
VALUES(1000,
	1,
	TO_DATE('2023-01-11', 'yyyy-mm-dd')
);
INSERT INTO POSTS(POST_ID, USER_ID, CREATE_AT)
VALUES(1001,
	2,
	TO_DATE('2023-01-11', 'yyyy-mm-dd')
);
INSERT INTO POSTS(POST_ID, USER_ID, CREATE_AT)
VALUES(1002,
	1,
	TO_DATE('2023-01-11', 'yyyy-mm-dd')
);
INSERT INTO POSTS(POST_ID, USER_ID, CREATE_AT)
VALUES(1003,
	3,
	TO_DATE('2023-01-11', 'yyyy-mm-dd')
);
INSERT INTO POSTS(POST_ID, USER_ID, CREATE_AT)
VALUES(1004,
	5,
	TO_DATE('2023-01-11', 'yyyy-mm-dd')
);

--TABLE: PHOTOINPOSTS--
INSERT INTO PHOTOINPOSTS(PHOTO_ID, IS_HIGHLIGHT, CREATE_AT)
VALUES(10000,
	1,
	TO_DATE('2023-01-11', 'yyyy-mm-dd'),
);
INSERT INTO PHOTOINPOSTS(PHOTO_ID, IS_HIGHLIGHT, CREATE_AT)
VALUES(10001,
	1,
	TO_DATE('2023-01-11', 'yyyy-mm-dd'),
);
INSERT INTO PHOTOINPOSTS(PHOTO_ID, IS_HIGHLIGHT, CREATE_AT)
VALUES(10002,
	0,
	TO_DATE('2023-01-11', 'yyyy-mm-dd'),
);
INSERT INTO PHOTOINPOSTS(PHOTO_ID, IS_HIGHLIGHT, CREATE_AT)
VALUES(10003,
	0,
	TO_DATE('2023-01-11', 'yyyy-mm-dd'),
);
INSERT INTO PHOTOINPOSTS(PHOTO_ID, IS_HIGHLIGHT, CREATE_AT)
VALUES(10004,
	1,
	TO_DATE('2023-01-11', 'yyyy-mm-dd'),
);
--TABLE: COMMENTS--
INSERT INTO COMMENTS(CMT_ID, USERS_ID, POST_ID, CREATE_AT)
VALUES(10,
    1,
    1000,
    TO_DATE('2023-01-11', 'yyyy-mm-dd')
);
INSERT INTO COMMENTS(CMT_ID, USERS_ID, POST_ID, CREATE_AT)
VALUES(20,
    3,
    1000,
    TO_DATE('2023-01-11', 'yyyy-mm-dd')
);
INSERT INTO COMMENTS(CMT_ID, USERS_ID, POST_ID, CREATE_AT)
VALUES(30,
    2,
    1001,
    TO_DATE('2023-01-11', 'yyyy-mm-dd')
);
INSERT INTO COMMENTS(CMT_ID, USERS_ID, POST_ID, CREATE_AT)
VALUES(40,
    0,
    1004,
    TO_DATE('2023-01-11', 'yyyy-mm-dd')
);
INSERT INTO COMMENTS(CMT_ID, USERS_ID, POST_ID, CREATE_AT)
VALUES(60,
    4,
    1003,
    TO_DATE('2023-01-11', 'yyyy-mm-dd')
);


--TABLE: REACTION--
INSERT INTO REACTIONS(REACT_ID, CREATE_AT, POST_ID, USER_ID, CMT_ID, REACT_TAG_ID)
VALUES(1110,
	TO_DATE('2023-01-11', 'yyyy-mm-dd'),
	1001,
	1,
	10,
	1100
);
INSERT INTO REACTIONS(REACT_ID, CREATE_AT, POST_ID, USER_ID, CMT_ID, REACT_TAG_ID)
VALUES(1120,
	TO_DATE('2023-01-11', 'yyyy-mm-dd'),
	1002,
	2,
	20,
	1200
);
INSERT INTO REACTIONS(REACT_ID, CREATE_AT, POST_ID, USER_ID, CMT_ID, REACT_TAG_ID)
VALUES(1130,
	TO_DATE('2023-01-11', 'yyyy-mm-dd'),
	1003,
	3,
	30,
	1300
);
INSERT INTO REACTIONS(REACT_ID, CREATE_AT, POST_ID, USER_ID, CMT_ID, REACT_TAG_ID)
VALUES(1140,
	TO_DATE('2023-01-11', 'yyyy-mm-dd'),
	1004,
	4,
	40,
	1400
);
INSERT INTO REACTIONS(REACT_ID, CREATE_AT, POST_ID, USER_ID, CMT_ID, REACT_TAG_ID)
VALUES(1150,
	TO_DATE('2023-01-11', 'yyyy-mm-dd'),
	1000,
	5,
	60,
	1500
);

--TABLE: NOTIFICATIONS--
INSERT INTO NOTIFICATIONS(NOTI_ID,IS_SEEN, IS_POPULAR, CREATE_AT, USER_ID, POST_ID)
VALUES(2000,
    1,
    0,
    TO_DATE('2023-01-11', 'yyyy-mm-dd'),
    1,
    1000
);
INSERT INTO NOTIFICATIONS(NOTI_ID,IS_SEEN, IS_POPULAR, CREATE_AT, USER_ID, POST_ID)
VALUES(2001,
    1,
    1,
    TO_DATE('2023-01-11', 'yyyy-mm-dd'),
    1,
    1001
);
INSERT INTO NOTIFICATIONS(NOTI_ID,IS_SEEN, IS_POPULAR, CREATE_AT, USER_ID, POST_ID)
VALUES(2002,
    0,
    1,
    TO_DATE('2023-01-11', 'yyyy-mm-dd'),
    1,
    1002
);
INSERT INTO NOTIFICATIONS(NOTI_ID,IS_SEEN, IS_POPULAR, CREATE_AT, USER_ID, POST_ID)
VALUES(2003,
    1,
    1,
    TO_DATE('2023-01-11', 'yyyy-mm-dd'),
    3,
    1003
);
INSERT INTO NOTIFICATIONS(NOTI_ID,IS_SEEN, IS_POPULAR, CREATE_AT, USER_ID, POST_ID)
VALUES(2004,
    0,
    0,
    TO_DATE('2023-01-11', 'yyyy-mm-dd'),
    5,
    1004
);

--PROCEDURE
create or replace
procedure reset_seq( p_seq_name in varchar2 )
is
    l_val number;
begin
    execute immediate
    'select ' || p_seq_name || '.nextval from dual' INTO l_val;

    execute immediate
    'alter sequence ' || p_seq_name || ' increment by -' || l_val || 
                                                          ' minvalue 0';

    execute immediate
    'select ' || p_seq_name || '.nextval from dual' INTO l_val;

    execute immediate
    'alter sequence ' || p_seq_name || ' increment by 1 minvalue 0';
end;
begin
      reset_seq(USER_SEQ);
--    reset_seq(ACCOUNT_SEQ);
--    reset_seq(ROLE_SEQ);
end;


--DROP ALL THE TABLE
CREATE OR REPLACE PROCEDURE DROP_ALL
IS
BEGIN
    FOR c IN (SELECT table_name FROM user_tables) LOOP
    EXECUTE IMMEDIATE ('DROP TABLE "' || c.table_name || '" CASCADE CONSTRAINTS');
    END LOOP;
    
    FOR s IN (SELECT sequence_name FROM user_sequences) LOOP
    EXECUTE IMMEDIATE ('DROP SEQUENCE ' || s.sequence_name);
    END LOOP;
END;
BEGIN
    DROP_ALL();
END;
